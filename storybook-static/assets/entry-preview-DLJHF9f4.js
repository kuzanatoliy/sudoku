import{_ as D}from"./chunk-QUZPS4B6-BfrmPkaN.js";import{$ as h,b as k,g as E,d as F,e as I,c as w,m,r as C,o as L,E as N}from"./web-Db2XvEIl.js";const S=Symbol("store-raw"),_=Symbol("store-node"),f=Symbol("store-has"),P=Symbol("store-self");function q(e){let r=e[h];if(!r&&(Object.defineProperty(e,h,{value:r=new Proxy(e,K)}),!Array.isArray(e))){const t=Object.keys(e),n=Object.getOwnPropertyDescriptors(e);for(let i=0,s=t.length;i<s;i++){const o=t[i];n[o].get&&Object.defineProperty(e,o,{enumerable:n[o].enumerable,get:n[o].get.bind(r)})}}return r}function b(e){let r;return e!=null&&typeof e=="object"&&(e[h]||!(r=Object.getPrototypeOf(e))||r===Object.prototype||Array.isArray(e))}function g(e,r=new Set){let t,n,i,s;if(t=e!=null&&e[S])return t;if(!b(e)||r.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):r.add(e);for(let o=0,u=e.length;o<u;o++)i=e[o],(n=g(i,r))!==i&&(e[o]=n)}else{Object.isFrozen(e)?e=Object.assign({},e):r.add(e);const o=Object.keys(e),u=Object.getOwnPropertyDescriptors(e);for(let l=0,a=o.length;l<a;l++)s=o[l],!u[s].get&&(i=e[s],(n=g(i,r))!==i&&(e[s]=n))}return e}function v(e,r){let t=e[r];return t||Object.defineProperty(e,r,{value:t=Object.create(null)}),t}function p(e,r,t){if(e[r])return e[r];const[n,i]=I(t,{equals:!1,internal:!0});return n.$=i,e[r]=n}function T(e,r){const t=Reflect.getOwnPropertyDescriptor(e,r);return!t||t.get||!t.configurable||r===h||r===_||(delete t.value,delete t.writable,t.get=()=>e[h][r]),t}function j(e){E()&&p(v(e,_),P)()}function U(e){return j(e),Reflect.ownKeys(e)}const K={get(e,r,t){if(r===S)return e;if(r===h)return t;if(r===k)return j(e),t;const n=v(e,_),i=n[r];let s=i?i():e[r];if(r===_||r===f||r==="__proto__")return s;if(!i){const o=Object.getOwnPropertyDescriptor(e,r);E()&&(typeof s!="function"||e.hasOwnProperty(r))&&!(o&&o.get)&&(s=p(n,r,s)())}return b(s)?q(s):s},has(e,r){return r===S||r===h||r===k||r===_||r===f||r==="__proto__"?!0:(E()&&p(v(e,f),r)(),r in e)},set(){return!0},deleteProperty(){return!0},ownKeys:U,getOwnPropertyDescriptor:T};function A(e,r,t,n=!1){if(!n&&e[r]===t)return;const i=e[r],s=e.length;t===void 0?(delete e[r],e[f]&&e[f][r]&&i!==void 0&&e[f][r].$()):(e[r]=t,e[f]&&e[f][r]&&i===void 0&&e[f][r].$());let o=v(e,_),u;if((u=p(o,r,i))&&u.$(()=>t),Array.isArray(e)&&e.length!==s){for(let l=e.length;l<s;l++)(u=o[l])&&u.$();(u=p(o,"length",s))&&u.$(e.length)}(u=o[P])&&u.$()}function W(e,r){const t=Object.keys(r);for(let n=0;n<t.length;n+=1){const i=t[n];A(e,i,r[i])}}function x(e,r){if(typeof r=="function"&&(r=r(e)),r=g(r),Array.isArray(r)){if(e===r)return;let t=0,n=r.length;for(;t<n;t++){const i=r[t];e[t]!==i&&A(e,t,i)}A(e,"length",n)}else W(e,r)}function y(e,r,t=[]){let n,i=e;if(r.length>1){n=r.shift();const o=typeof n,u=Array.isArray(e);if(Array.isArray(n)){for(let l=0;l<n.length;l++)y(e,[n[l]].concat(r),t);return}else if(u&&o==="function"){for(let l=0;l<e.length;l++)n(e[l],l)&&y(e,[l].concat(r),t);return}else if(u&&o==="object"){const{from:l=0,to:a=e.length-1,by:c=1}=n;for(let d=l;d<=a;d+=c)y(e,[d].concat(r),t);return}else if(r.length>1){y(e[n],r,[n].concat(t));return}i=e[n],t=[n].concat(t)}let s=r[0];typeof s=="function"&&(s=s(i,t),s===i)||n===void 0&&s==null||(s=g(s),n===void 0||b(i)&&b(s)&&!Array.isArray(s)?W(i,s):A(e,n,s))}function Q(...[e,r]){const t=g(e||{}),n=Array.isArray(t),i=q(t);function s(...o){F(()=>{n&&o.length===1?x(t,o[0]):y(t,o)})}return[i,s]}var V={};D(V,{decorators:()=>se,parameters:()=>ie,render:()=>ne,renderToCanvas:()=>te});var z=new Error("request for lock canceled"),M=function(e,r,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(c){try{a(n.next(c))}catch(d){o(d)}}function l(c){try{a(n.throw(c))}catch(d){o(d)}}function a(c){c.done?s(c.value):i(c.value).then(u,l)}a((n=n.apply(e,r||[])).next())})},B=class{constructor(e,r=z){this._value=e,this._cancelError=r,this._queue=[],this._weightedWaiters=[]}acquire(e=1,r=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t,n)=>{let i={resolve:t,reject:n,weight:e,priority:r},s=R(this._queue,o=>r<=o.priority);s===-1&&e<=this._value?this._dispatchItem(i):this._queue.splice(s+1,0,i)})}runExclusive(e){return M(this,arguments,void 0,function*(r,t=1,n=0){let[i,s]=yield this.acquire(t,n);try{return yield r(i)}finally{s()}})}waitForUnlock(e=1,r=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,r)?Promise.resolve():new Promise(t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),H(this._weightedWaiters[e-1],{resolve:t,priority:r})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){let r=this._value;this._value-=e.weight,e.resolve([r,this._newReleaser(e.weight)])}_newReleaser(e){let r=!1;return()=>{r||(r=!0,this.release(e))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let e=this._value;e>0;e--){let r=this._weightedWaiters[e-1];r&&(r.forEach(t=>t.resolve()),this._weightedWaiters[e-1]=[])}else{let e=this._queue[0].priority;for(let r=this._value;r>0;r--){let t=this._weightedWaiters[r-1];if(!t)continue;let n=t.findIndex(i=>i.priority<=e);(n===-1?t:t.splice(0,n)).forEach(i=>i.resolve())}}}_couldLockImmediately(e,r){return(this._queue.length===0||this._queue[0].priority<r)&&e<=this._value}};function H(e,r){let t=R(e,n=>r.priority<=n.priority);e.splice(t+1,0,r)}function R(e,r){for(let t=e.length-1;t>=0;t--)if(r(e[t]))return t;return-1}var[$,O]=Q({}),X=(e,r)=>{let t=r.canvasElement.id;return r.args=$[t].args,w(e,m(()=>r.args))},Y=e=>{O({[e]:{args:{},rendered:!1,disposeFn:()=>{}}})},G=e=>{var r,t;(t=(r=$[e])==null?void 0:r.disposeFn)==null||t.call(r)},J=e=>{G(e),Y(e)},Z=e=>{var r;return!!((r=$[e])!=null&&r.rendered)},ee=(e,r,t)=>{let{storyContext:n,storyFn:i,showMain:s,showException:o}=r;O(e,"rendered",!0);let u=()=>{let l=i;return L(()=>{s()}),w(N,{fallback:a=>(o(a),a),get children(){return w(l,n)}})};return C(()=>w(u,{}),t)},re=new B(1);async function te(e,r){let{storyContext:t,forceRemount:n}=e,i=t.canvasElement.id;n&&J(i),O(i,"args",t.args),Z(i)===!1&&await re.runExclusive(async()=>{let s=ee(i,e,r);O(i,o=>({...o,disposeFn:s}))})}var ne=(e,r)=>{let{id:t,component:n}=r;if(!n)throw new Error(`Unable to render story ${t} as the component annotation is missing from the default export`);return w(n,m(()=>r.args))},ie={renderer:"solid"},se=[X];export{se as decorators,ie as parameters,ne as render,te as renderToCanvas};
